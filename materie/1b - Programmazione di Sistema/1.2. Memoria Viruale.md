# Premessa
- Il codice ha bisogno di essere in memoria per essere eseguito, ma raramente un programma utilizza tutto lo spazio messo a disposizione.
- Si considera la possibilità di eseguire programmi caricati parzialmente.
	- Programma non più limitato dalla memoria fisica.
	- Ogni programma richiede meno memoria, più programmi possono essere eseguiti allo stesso tempo.
	- Meno I/O per swappare e caricare pagine in memoria.

# Memoria virtuale
- Separazione netta tra memoria logica e memoria fisica.
	- Spazio di indirizzamento logico più grande, permette anche la condivisione tra processi.

- **Virtual address space** = visione logica di come il processo si trova in memoria.
	- Solitamente parte dall'indirizzo 0 ed è contiguo.
	- La memoria fisica è organizzata in **page frame**.
	- **MMU** deve mappare indirizzi logici a indirizzi fisici.
- La memoria virtuale può essere implementata tramite:
	- **Demand paging**
	- **Demand segmentation**
#TODO schema sulle slides

## Demand paging
- Una pagina viene caricata in memoria solo quando è necessaria.
- Simile a paging system con swapping.
- Pagina richiesta -> Referenziata dal backing store o dall'heap/stack.
	- Invalid reference -> **abort**.
	- Not in memory -> **bring to memory**.
- **Lazy swapper** = non scambia mai una pagina in memoria a meno che non sia richiesta.
	- Lo swapper che gestisce le pagine è il **pager**.

### Concetti di base
- Quando accade lo swapping, il pager cerca di portare in memoria le pagine necessarie 

 #### Valid/Invalid bit
 - **Valido** = la pagina è in memoria, associato un frame. (*memory resident*)
 - **Non valido** = non in memoria.
	 - Accedere ad una pagina non valida dalla page table scatena una **trap** del kernel. (**Page fault**)

#### Gestione del Page fault
1. Il sistema operativo controlla le informazioni aggiuntive per decidere:
	1. Invalid reference -> Abort
	2. Non in memoria
2. Trova un free frame.
3. Swap della page dal backing store al frame (operazione su disco)
4. Resetta le tabelle per indicare che ora la pagina è in memoria (validity bit = 1)
5. Restart dell'istruzione che ha causato il page fault.

#### Free frame list
#TODO vedi slides

### Aspetti del demand paging
Caso estremo: un processo inizia senza pagine in memoria
- **Pure demand paging**

Un'istruzione può richiedere accesso a diverse pagine
- Per la **locality of reference** è possibile che le pagine siano caricate insieme in memoria.

Necessario supporto hardware per demand paging:
- Page table con valid/invalid bit.
- Memoria secondaria (dispositivo per permettere lo **swap**).
- Restart delle istruzioni

#### Stage del demand paging
#TODO vedi slides


#### Performance